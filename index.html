<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Math Balloons</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg1:#b3e5fc; --bg2:#ffffff;
    --ink:#1f2937; --brand:#ff4d6d; --ok:#22c55e; --bad:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: linear-gradient(180deg,var(--bg1),var(--bg2));
    overflow:hidden; color:var(--ink);
  }
  #game{
    position:relative; width:100vw; height:100vh; overflow:hidden;
  }
  /* HUD */
  .hud{
    position:absolute; top:10px; left:10px; right:10px; z-index:5;
    display:flex; gap:10px; align-items:center; justify-content:space-between;
    padding:8px 12px; background:rgba(255,255,255,.85);
    border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.12);
    font-weight:600; flex-wrap:wrap;
  }
  .hud .group{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
  .badge{padding:6px 10px; border-radius:10px; background:#eef2ff}
  #lives{letter-spacing:2px}
  #question{font-size:clamp(18px,3.2vw,28px); font-weight:800}
  .muter{display:flex; align-items:center; gap:8px; font-weight:600}
  .muter input{width:18px; height:18px}

  /* Balloons */
  .balloon{
    position:absolute; width:72px; height:96px; will-change:transform, opacity;
    border-radius:50% 50% 50% 50%/60% 60% 40% 40%;
    box-shadow: inset 0 10px 18px rgba(255,255,255,.45),
                0 10px 16px rgba(0,0,0,.18);
    display:flex; align-items:center; justify-content:center;
    color:#111; font-weight:800; font-size:22px; user-select:none; cursor:pointer;
  }
  .balloon .string{
    position:absolute; left:50%; top:86px; width:2px; height:34px;
    background:rgba(0,0,0,.25); transform:translateX(-50%);
  }
  .pop{transform:scale(1.15)!important; opacity:.2!important; transition:.12s ease}

  /* Overlays */
  .overlay{
    position:absolute; inset:0; z-index:10; display:flex;
    flex-direction:column; align-items:center; justify-content:center;
    text-align:center; padding:24px; background:rgba(0,0,0,.6); color:#fff;
  }
  .overlay h1{margin:0 0 8px; font-size:clamp(28px,6vw,40px)}
  .overlay p{opacity:.95; font-size:clamp(16px,3.2vw,18px)}
  .btn{
    margin-top:16px; padding:12px 20px; font-size:18px; border:0; border-radius:12px;
    color:#fff; background:var(--brand); cursor:pointer;
    box-shadow:0 10px 20px rgba(255,77,109,.35);
  }
  .btn:hover{filter:brightness(1.06)}
  .hide{display:none}

  /* Mobile */
  @media (max-width:480px){
    .balloon{width:64px; height:86px; font-size:20px}
  }
</style>
</head>
<body>
  <div id="game">
    <!-- HUD -->
    <div class="hud" id="hud">
      <div class="group">
        <div id="question" class="badge">What is 2 + 3 ?</div>
        <div id="score" class="badge">Score: 0</div>
        <div id="level" class="badge">Level: 1</div>
      </div>
      <div class="group">
        <div id="timer" class="badge">Time: 15s</div>
        <div id="lives" class="badge">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        <label class="muter">
          <input type="checkbox" id="muteToggle" />
          Mute
        </label>
      </div>
    </div>

    <!-- Start -->
    <div id="intro" class="overlay">
      <h1>üéà Math Balloons</h1>
      <p>Pop the balloon with the correct answer before time runs out!</p>
      <p>Each mistake costs a heart. Get 10 correct answers to win.</p>
      <button class="btn" id="startBtn">Start Game</button>
    </div>

    <!-- End -->
    <div id="end" class="overlay hide">
      <h1 id="endTitle">Game Over</h1>
      <p id="endStats">Your Score: 0</p>
      <button class="btn" id="againBtn">Play Again</button>
    </div>
  </div>

  <!-- Audio (royalty-free from Pixabay CDN) -->
  <audio id="bgm" src="https://cdn.pixabay.com/audio/2022/03/15/audio_5d5f2f7b79.mp3" loop preload="none"></audio>
  <audio id="popSnd" src="https://cdn.pixabay.com/audio/2022/03/15/audio_6d2f5b4e7b.mp3" preload="none"></audio>
  <audio id="okSnd"  src="https://cdn.pixabay.com/audio/2022/03/15/audio_1dbe94d885.mp3" preload="none"></audio>
  <audio id="badSnd" src="https://cdn.pixabay.com/audio/2022/03/15/audio_6f3cfc7f1b.mp3" preload="none"></audio>
  <audio id="tickSnd" src="https://cdn.pixabay.com/audio/2022/03/15/audio_2c63180e8a.mp3" preload="none"></audio>

<script>
(() => {
  // Elements
  const root = document.getElementById('game');
  const hud = {
    question: document.getElementById('question'),
    score: document.getElementById('score'),
    level: document.getElementById('level'),
    timer: document.getElementById('timer'),
    lives: document.getElementById('lives'),
    mute: document.getElementById('muteToggle')
  };
  const intro = document.getElementById('intro');
  const startBtn = document.getElementById('startBtn');
  const end = document.getElementById('end');
  const endTitle = document.getElementById('endTitle');
  const endStats = document.getElementById('endStats');
  const againBtn = document.getElementById('againBtn');

  // Audio
  const bgm = document.getElementById('bgm');
  const popSnd = document.getElementById('popSnd');
  const okSnd  = document.getElementById('okSnd');
  const badSnd = document.getElementById('badSnd');
  const tickSnd= document.getElementById('tickSnd');

  // State
  let score = 0, level = 1, lives = 3, timeLeft = 15;
  let correctAnswer = null, balloons = [];
  let rafId = null, spawnId = null, timerId = null;
  let playing = false;
  const TARGET_CORRECT = 10; // to win
  const COLORS = ['#ff4d6d','#4dabf7','#38d9a9','#ffd43b','#845ef7','#ff922b','#60a5fa','#f472b6'];

  function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }

  // Question generator (+, ‚àí, √ó) with safe ranges
  function makeQuestion() {
    const ops = ['+','-','√ó'];
    const op = ops[randInt(0, ops.length-1)];
    let a, b, ans;
    switch(op){
      case '+':
        a = randInt(1, 8 + level*2);
        b = randInt(1, 8 + level*2);
        ans = a + b;
        break;
      case '-':
        a = randInt(2, 10 + level*2);
        b = randInt(1, a); // no negative
        ans = a - b;
        break;
      case '√ó':
        a = randInt(1, clamp(5,1,3+level)); // grows slowly
        b = randInt(1, clamp(5,1,3+level));
        ans = a * b;
        break;
    }
    correctAnswer = ans;
    hud.question.textContent = `What is ${a} ${op} ${b} ?`;
    // build choices (1 correct + 2~3 wrong)
    const set = new Set([ans]);
    while(set.size < 4){
      const delta = randInt(-6, 6) || 1;
      set.add(ans + delta);
    }
    return Array.from(set).sort(() => Math.random() - .5);
  }

  // Balloon factory (spawns candidates for current question)
  function spawnBalloons() {
    clearBalloons();
    const choices = makeQuestion();
    const w = root.clientWidth, h = root.clientHeight;
    const laneCount = Math.min(choices.length, 5);
    for(let i=0;i<choices.length;i++){
      const b = document.createElement('div');
      b.className = 'balloon';
      b.style.background = COLORS[i % COLORS.length];
      const lane = i % laneCount;
      const margin = 24;
      const laneWidth = (w - margin*2) / laneCount;
      const x = margin + laneWidth * lane + (laneWidth - 72)/2;
      const startY = h + randInt(0, 60);
      b.style.left = x + 'px';
      b.style.top  = startY + 'px';
      b.dataset.value = choices[i];
      b.textContent = choices[i];
      const string = document.createElement('div');
      string.className = 'string';
      b.appendChild(string);

      // speed increases with level
      b._vy = 70 + level*20 + Math.random()*30;
      b._y = startY;

      b.addEventListener('pointerdown', () => {
        if(!playing) return;
        popSndTry();
        b.classList.add('pop');
        setTimeout(()=>b.remove(), 120);
        if (Number(b.dataset.value) === correctAnswer) {
          score += 1;
          okTry();
          nextRound(true);
        } else {
          lives -= 1;
          badTry();
          nextRound(false);
        }
      }, {passive:true});

      root.appendChild(b);
      balloons.push(b);
    }
  }

  function clearBalloons(){
    balloons.forEach(b => b.remove());
    balloons = [];
  }

  function loop(){
    const dt = 1/60;
    const h = root.clientHeight;
    balloons.forEach(b=>{
      b._y -= b._vy * dt;
      if(b._y < -120) {
        // if the correct one escapes, count as mistake
        if (Number(b.dataset.value) === correctAnswer) {
          lives = Math.max(0, lives - 1);
          updateHUD();
          // move immediately to next round
          nextRound(false, true);
        }
        b.remove();
      } else {
        b.style.transform = `translateY(${b._y - h}px)`;
      }
    });
    balloons = balloons.filter(b => b.isConnected);
    rafId = requestAnimationFrame(loop);
  }

  function updateHUD(){
    hud.score.textContent = `Score: ${score}`;
    hud.level.textContent = `Level: ${level}`;
    hud.timer.textContent = `Time: ${timeLeft}s`;
    hud.lives.textContent = '‚ù§Ô∏è'.repeat(lives) + 'üñ§'.repeat(3 - lives);
  }

  function startTimer(){
    clearInterval(timerId);
    timeLeft = 15;
    updateHUD();
    timerId = setInterval(()=>{
      timeLeft--;
      if(!hud.mute.checked && timeLeft<=5 && timeLeft>0) tickSnd.play().catch(()=>{});
      updateHUD();
      if(timeLeft<=0){
        clearInterval(timerId);
        lives -= 1;
        badTry();
        nextRound(false);
      }
    },1000);
  }

  function nextRound(correct, escaped=false){
    // stop timer and clear balloons then decide state
    clearInterval(timerId);
    clearBalloons();
    if(correct){
      // every 3 correct answers, level up
      if(score % 3 === 0) level++;
    }
    if(lives <= 0){
      return endGame(false);
    }
    if(score >= TARGET_CORRECT){
      return endGame(true);
    }
    // continue
    spawnBalloons();
    startTimer();
    updateHUD();
  }

  function startGame(){
    // reset state
    score = 0; level = 1; lives = 3;
    playing = true;
    intro.classList.add('hide');
    end.classList.add('hide');
    updateHUD();
    // audio policy: start after user action
    if(!hud.mute.checked){
      bgm.volume = 0.35;
      bgm.play().catch(()=>{});
    }
    // main loop + first round
    spawnBalloons();
    startTimer();
    cancelAnimationFrame(rafId);
    rafId = requestAnimationFrame(loop);
  }

  function endGame(win){
    playing = false;
    clearInterval(timerId);
    cancelAnimationFrame(rafId);
    clearBalloons();
    endTitle.textContent = win ? 'üéâ You Win!' : 'üò¢ Game Over';
    endStats.textContent = `Score: ${score} ‚Ä¢ Level: ${level}`;
    end.classList.remove('hide');
  }

  // Small audio helpers (respect mute)
  function popSndTry(){ if(!hud.mute.checked) popSnd.play().catch(()=>{}); }
  function okTry(){ if(!hud.mute.checked) okSnd.play().catch(()=>{}); }
  function badTry(){ if(!hud.mute.checked) badSnd.play().catch(()=>{}); }

  // Events
  startBtn.addEventListener('click', startGame);
  againBtn.addEventListener('click', startGame);
  hud.mute.addEventListener('change', ()=>{
    if(hud.mute.checked){ bgm.pause(); }
    else if(playing){ bgm.play().catch(()=>{}); }
  });

  // Keep balloons in bounds on resize
  window.addEventListener('resize', ()=>{
    balloons.forEach(b=>{
      const x = parseFloat(b.style.left)||0;
      const max = root.clientWidth - 72;
      if(x>max) b.style.left = Math.max(0,max)+'px';
    });
  });
})();
</script>
</body>
</html>

